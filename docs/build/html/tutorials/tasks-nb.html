<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>Create a custom Task - MotorNet 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">MotorNet 1.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">MotorNet 1.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../motornet.html">MotorNet</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../motornet.nets.html">motornet.nets</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../motornet.nets.callbacks.html">motornet.nets.callbacks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../motornet.nets.layers.html">motornet.nets.layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../motornet.nets.losses.html">motornet.nets.losses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../motornet.nets.models.html">motornet.nets.models</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../motornet.plants.html">motornet.plants</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../motornet.plants.muscles.html">motornet.plants.muscles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../motornet.plants.skeletons.html">motornet.plants.skeletons</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../motornet.utils.html">motornet.utils</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../motornet.utils.plotor.html">motornet.utils.plotor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../motornet.task.html">motornet.task</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation/install.html">How to Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/bp-loss-selection.html">Best Practices: Loss Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="muscle-demo.html">How Muscle Objects Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-plant.html">Build a Plant</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-net.html">Build a Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="states.html">Structure of State Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="tasks.html">Create a custom Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="train-net.html">Train a Network</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Create-a-custom-Task">
<h1>Create a custom Task<a class="headerlink" href="#Create-a-custom-Task" title="Permalink to this headline">#</a></h1>
<p>In this tutorial, we will go over <code class="docutils literal notranslate"><span class="pre">Task</span></code> objects, how they work and how to build a custom subclass to implement your own task design.</p>
<p>Let’s start by importing what we need.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">colab_env</span> <span class="o">=</span> <span class="s1">'google.colab'</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_ipython</span><span class="p">())</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">__builtins__</span><span class="p">,</span><span class="s1">'__IPYTHON__'</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
<span class="n">colab_initialized</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">"MotorNet"</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

<span class="k">if</span> <span class="n">colab_env</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">colab_initialized</span><span class="p">:</span>
  <span class="o">!</span>git clone https://github.com/OlivierCodol/MotorNet
  <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'MotorNet'</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"Running cell using COLAB initialization..."</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">colab_env</span> <span class="ow">and</span> <span class="n">colab_initialized</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"Already initialized using COLAB initialization."</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
  <span class="n">local_initialized</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="s2">"motornet"</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span> <span class="k">else</span> <span class="kc">False</span>
  <span class="k">if</span> <span class="n">local_initialized</span><span class="p">:</span>
    <span class="o">%</span><span class="k">load_ext</span> autoreload
    <span class="o">%</span><span class="k">autoreload</span> 2
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Already initialized using LOCAL initialization."</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="s2">"tutorials"</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Path to MotorNet could not be determined with certainty."</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="n">path</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">'tutorials'</span><span class="p">)]))</span>
    <span class="o">%</span><span class="k">load_ext</span> autoreload
    <span class="o">%</span><span class="k">autoreload</span> 2
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Running cell using LOCAL initialization..."</span><span class="p">)</span>


<span class="kn">import</span> <span class="nn">motornet</span> <span class="k">as</span> <span class="nn">mn</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'All packages imported.'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'tensorflow version: '</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'numpy version: '</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Already initialized using LOCAL initialization.
All packages imported.
tensorflow version: 2.7.0
numpy version: 1.21.5
</pre></div></div>
</div>
</section>
<section id="I.-Useful-methods-in-Task-objects">
<h1>I. Useful methods in Task objects<a class="headerlink" href="#I.-Useful-methods-in-Task-objects" title="Permalink to this headline">#</a></h1>
<p>Several methods are useful to assess what your task object currently contains. - The <code class="docutils literal notranslate"><span class="pre">print_attributes</span></code> method will print all attributes held by the <code class="docutils literal notranslate"><span class="pre">Task</span></code> instance as well as their current value. This includes the losses declared via the <code class="docutils literal notranslate"><span class="pre">Task</span></code> object. - The <code class="docutils literal notranslate"><span class="pre">get_attributes</span></code> method will fetch those attributes, and return two lists: one with the name of each attribute, and one with the associated value of each attribute. - The <code class="docutils literal notranslate"><span class="pre">print_loss</span></code> method will print the losses currently
declared via the <code class="docutils literal notranslate"><span class="pre">add_loss</span></code> method.</p>
<p>First, let’s import a built-in <code class="docutils literal notranslate"><span class="pre">Task</span></code> object and create an instance of it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">plant</span> <span class="o">=</span> <span class="n">mn</span><span class="o">.</span><span class="n">plants</span><span class="o">.</span><span class="n">ReluPointMass24</span><span class="p">()</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">mn</span><span class="o">.</span><span class="n">nets</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GRUNetwork</span><span class="p">(</span><span class="n">plant</span><span class="o">=</span><span class="n">plant</span><span class="p">,</span> <span class="n">n_units</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'network'</span><span class="p">)</span>

<span class="n">task</span> <span class="o">=</span> <span class="n">mn</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">CentreOutReach</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">task</span><span class="o">.</span><span class="n">print_attributes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
angular_step:  15
catch_trial_perc:  50
delay_range:  [5, 25]
do_recompute_targets:  False
dt:  0.01
go_cue_range:  [5, 25]
initial_joint_state:  None
initial_joint_state_original:  None
n_initial_joint_states:  None
reaching_distance:  0.1
start_position:  [[0. 0.]]
training_batch_size:  32
training_n_timesteps:  100

loss_weights:
 {'joint position': 0.0, 'cartesian position': 1.0, 'muscle state': 5, 'geometry state': 0.0, 'proprioceptive feedback': 0.0, 'visual feedback': 0.0, 'excitation': 0.0, 'gru_hidden_0': 0.1}

losses:
 {'joint position': None, 'cartesian position': &lt;motornet.nets.losses.PositionLoss object at 0x000001A3594E0C70&gt;, 'muscle state': &lt;motornet.nets.losses.L2xDxActivationLoss object at 0x000001A3594E0BE0&gt;, 'geometry state': None, 'proprioceptive feedback': None, 'visual feedback': None, 'excitation': None, 'gru_hidden_0': &lt;motornet.nets.losses.L2xDxRegularizer object at 0x000001A3594E0B80&gt;}

loss_names:
 {'joint position': 'joint position', 'cartesian position': 'position', 'muscle state': 'l2_xdx_activation', 'geometry state': 'geometry state', 'proprioceptive feedback': 'proprioceptive feedback', 'visual feedback': 'visual feedback', 'excitation': 'excitation', 'gru_hidden_0': 'gru_regularizer'}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">attr_names</span><span class="p">,</span> <span class="n">attr_values</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">attr_names</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">attr_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['angular_step', 'catch_trial_perc', 'delay_range', 'do_recompute_targets', 'dt', 'go_cue_range', 'initial_joint_state', 'initial_joint_state_original', 'n_initial_joint_states', 'reaching_distance', 'start_position', 'training_batch_size', 'training_n_timesteps']
[15, 50, [5, 25], False, 0.01, [5, 25], None, None, None, 0.1, array([[0., 0.]], dtype=float32), 32, 100]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">task</span><span class="o">.</span><span class="n">print_losses</span><span class="p">()</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ASSIGNED OUTPUT: cartesian position
-----------------------------------
loss function:  &lt;motornet.nets.losses.PositionLoss object at 0x000001A3594E0C70&gt;
loss weight:    1.0
loss name:      position
Compounded:     NO


ASSIGNED OUTPUT: muscle state
-----------------------------
loss function:  &lt;motornet.nets.losses.L2xDxActivationLoss object at 0x000001A3594E0BE0&gt;
loss weight:    5
loss name:      l2_xdx_activation
Compounded:     NO


ASSIGNED OUTPUT: gru_hidden_0
-----------------------------
loss function:  &lt;motornet.nets.losses.L2xDxRegularizer object at 0x000001A3594E0B80&gt;
loss weight:    0.1
loss name:      gru_regularizer
Compounded:     NO


</pre></div></div>
</div>
<p>If we then add another loss using the <code class="docutils literal notranslate"><span class="pre">add_loss</span></code> method, and re-print the losses, the new loss will be included in the print-out.</p>
<p>Note that “Compounded” indicates if the loss shares an assigned output with another loss (see the tutorial on losses for more details).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">task</span><span class="o">.</span><span class="n">add_loss</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">mn</span><span class="o">.</span><span class="n">nets</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">PositionLoss</span><span class="p">(),</span> <span class="n">assigned_output</span><span class="o">=</span><span class="s2">"cartesian position"</span><span class="p">)</span>
<span class="n">task</span><span class="o">.</span><span class="n">print_losses</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ASSIGNED OUTPUT: cartesian position
-----------------------------------
loss function:  &lt;motornet.nets.losses.PositionLoss object at 0x000001A3594E0C70&gt;
loss weight:    1.0
loss name:      position
Compounded:     YES


ASSIGNED OUTPUT: cartesian position
-----------------------------------
loss function:  &lt;motornet.nets.losses.PositionLoss object at 0x000001A359558250&gt;
loss weight:    1.0
loss name:      position
Compounded:     YES


ASSIGNED OUTPUT: muscle state
-----------------------------
loss function:  &lt;motornet.nets.losses.L2xDxActivationLoss object at 0x000001A3594E0BE0&gt;
loss weight:    5
loss name:      l2_xdx_activation
Compounded:     NO


ASSIGNED OUTPUT: gru_hidden_0
-----------------------------
loss function:  &lt;motornet.nets.losses.L2xDxRegularizer object at 0x000001A3594E0B80&gt;
loss weight:    0.1
loss name:      gru_regularizer
Compounded:     NO


</pre></div></div>
</div>
</section>
<section id="II.-Initializing-a-MotorNetModel-with-a-Task-object">
<h1>II. Initializing a MotorNetModel with a Task object<a class="headerlink" href="#II.-Initializing-a-MotorNetModel-with-a-Task-object" title="Permalink to this headline">#</a></h1>
<p>In <code class="docutils literal notranslate"><span class="pre">tensorflow</span></code>, creating a model requires declaring <code class="docutils literal notranslate"><span class="pre">tf.keras.layers.Input</span></code> layers that will handle the input and initial state data. Creating these <code class="docutils literal notranslate"><span class="pre">Input</span></code> layers mainly require to declare the shape of the arrays that will be passed through. The <code class="docutils literal notranslate"><span class="pre">Task</span></code> class should provide those using the <code class="docutils literal notranslate"><span class="pre">get_input_dict_layers</span></code> and <code class="docutils literal notranslate"><span class="pre">get_initial_state_layers</span></code> methods.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get_input_dict_layers</span><span class="p">()</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="s2">" :--&gt; "</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
inputs :--&gt;  KerasTensor(type_spec=TensorSpec(shape=(None, None, 5), dtype=tf.float32, name='inputs'), name='inputs', description="created by layer 'inputs'")
</pre></div></div>
</div>
<p>As we can see, the input layer is simply a dictionary containing <code class="docutils literal notranslate"><span class="pre">keras</span></code> tensors.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">state0</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get_initial_state_layers</span><span class="p">()</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">state0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
KerasTensor(type_spec=TensorSpec(shape=(None, 4), dtype=tf.float32, name='joint0'), name='joint0', description="created by layer 'joint0'")
KerasTensor(type_spec=TensorSpec(shape=(None, 4), dtype=tf.float32, name='cartesian0'), name='cartesian0', description="created by layer 'cartesian0'")
KerasTensor(type_spec=TensorSpec(shape=(None, 4, 4), dtype=tf.float32, name='muscle0'), name='muscle0', description="created by layer 'muscle0'")
KerasTensor(type_spec=TensorSpec(shape=(None, 4, 4), dtype=tf.float32, name='geometry0'), name='geometry0', description="created by layer 'geometry0'")
KerasTensor(type_spec=TensorSpec(shape=(None, 8, 1), dtype=tf.float32, name='proprio_feedback0'), name='proprio_feedback0', description="created by layer 'proprio_feedback0'")
KerasTensor(type_spec=TensorSpec(shape=(None, 2, 1), dtype=tf.float32, name='visual_feedback0'), name='visual_feedback0', description="created by layer 'visual_feedback0'")
KerasTensor(type_spec=TensorSpec(shape=(None, 4), dtype=tf.float32, name='excitation'), name='excitation', description="created by layer 'excitation'")
KerasTensor(type_spec=TensorSpec(shape=(None, 50), dtype=tf.float32, name='gru_hidden_0_0'), name='gru_hidden_0_0', description="created by layer 'gru_hidden_0_0'")
</pre></div></div>
</div>
<p>Conversely, the initial state is a list of <code class="docutils literal notranslate"><span class="pre">keras</span></code> tensors. This difference is simply because <code class="docutils literal notranslate"><span class="pre">tensorflow</span></code> models are built with that logic, and so require initial states to be lists. Inputs don’t have to be dictionary but dictionaries are in practice clearer and more versatile than lists so we chose this over other possibilities.</p>
</section>
<section id="III.-Subclassing-a-Task-object">
<h1>III. Subclassing a Task object<a class="headerlink" href="#III.-Subclassing-a-Task-object" title="Permalink to this headline">#</a></h1>
<p>Now let’s try to build our own task design. To do so, we will go over a simple subclassing process to create a custom task.</p>
<section id="III.-1.-Initialization-of-the-Task-subclass">
<h2>III. 1. Initialization of the Task subclass<a class="headerlink" href="#III.-1.-Initialization-of-the-Task-subclass" title="Permalink to this headline">#</a></h2>
<p>The base class for tasks is <code class="docutils literal notranslate"><span class="pre">mn.tasks.Task</span></code>, so we will make the custom task inherit from that base class. We can then define a <code class="docutils literal notranslate"><span class="pre">__name__</span></code> for the class, and declare the losses in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method using a <code class="docutils literal notranslate"><span class="pre">self.add_loss</span></code> method that is inherited from the base class.</p>
<p>Note that declaring losses through the <code class="docutils literal notranslate"><span class="pre">Task</span></code> object is not mandatory for the simulation to run, but this is easier, as otherwise we would have to manually do all the things that the <code class="docutils literal notranslate"><span class="pre">add_loss</span></code> method does automatically for us. Also this may result in misleading (shuffled) loss labels when printing progress bars at runtime because <code class="docutils literal notranslate"><span class="pre">tensorflow</span></code> models (<code class="docutils literal notranslate"><span class="pre">tf.keras.Model</span></code>) do not maintain loss label orders properly (the loss dictionary gets flattened). Adding losses to the task object will
make it available to our curstom-made <code class="docutils literal notranslate"><span class="pre">tf.keras.Model</span></code> subclass, which is <code class="docutils literal notranslate"><span class="pre">mn.nets.MotorNetModel</span></code>. In <code class="docutils literal notranslate"><span class="pre">MotorNetModel</span></code> the losses available in <code class="docutils literal notranslate"><span class="pre">Task</span></code> subclasses will be re-ordered properly to avoid the parent class <code class="docutils literal notranslate"><span class="pre">tf.keras.Model</span></code> reshuffling the labels in a wrong order.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">add_loss</span></code> method takes three arguments: - <code class="docutils literal notranslate"><span class="pre">assigned_output</span></code> should be a string matching one of the keys of the <code class="docutils literal notranslate"><span class="pre">MotorNetModel</span></code>’s output dictionary. Of note, each key corresponds to a state of the model. In its current version, <code class="docutils literal notranslate"><span class="pre">motornet</span></code> only allows one loss per output key. - <code class="docutils literal notranslate"><span class="pre">loss</span></code> should pass a loss object, either custom-made or from the <code class="docutils literal notranslate"><span class="pre">mn.nets.losses</span></code> module. - <code class="docutils literal notranslate"><span class="pre">loss_weight</span></code> is a scalar that defines the weight of the loss in the global loss that the network will
optimize at runtime.</p>
</section>
<section id="III.-2.-Generating-inputs">
<h2>III. 2. Generating inputs<a class="headerlink" href="#III.-2.-Generating-inputs" title="Permalink to this headline">#</a></h2>
<p>We can next define the <code class="docutils literal notranslate"><span class="pre">task.generate</span></code> method. It should take as inputs: - <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> - <code class="docutils literal notranslate"><span class="pre">n_timesteps</span></code></p>
<p>If desired, it can also take <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> inputs.</p>
<p>It should produce as output a list containing three items, in the order below: - A dictionary containing the inputs to the network. - The targets that will be passed to the network (often called <code class="docutils literal notranslate"><span class="pre">y</span></code> or <code class="docutils literal notranslate"><span class="pre">y_true</span></code>, as opposed to <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y_pred</span></code>). - The initial states to the network.</p>
<section id="III.-2.-a.-Input-dictionary">
<h3>III. 2. a. Input dictionary<a class="headerlink" href="#III.-2.-a.-Input-dictionary" title="Permalink to this headline">#</a></h3>
<p>The input dictionary only requires a “inputs” key. The value assigned to that key will be passed as-is as input to the network for a forward pass. So is content is essentially up to the user, according to what the user wishes the network to receive as input information. Typically, for a reaching movement, this could be the target’s position in cartesian coordinates. If a delayed reach is desired, one could consider adding a go cue as well.</p>
<p>Similar to states, the first dimension (rows) should always be <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> and the second dimension (columns) should always be the number of timesteps for the reach. This is true for any value in that dictionary, not just for the value associated with the “inputs” key.</p>
<p>Other notable keys one may add are “joint_load” and “endpoint_load”. These would be transmitted to the plant by the network. If one wishes to add more keys to the input dictionary, it would be required to subclass the network to implement appropriate handling of these custom-made keys in the <code class="docutils literal notranslate"><span class="pre">call</span></code> method of the network.</p>
<p>We decided to use a dictionary as input because of the flexibility and clarity of code it provides. Note however that generally, <code class="docutils literal notranslate"><span class="pre">tensorflow</span></code> models can accept other forms of inputs, such as simple arrays, though our <code class="docutils literal notranslate"><span class="pre">motornet</span></code> model will not handle them.</p>
</section>
<section id="III.-2.-b.-Targets">
<h3>III. 2. b. Targets<a class="headerlink" href="#III.-2.-b.-Targets" title="Permalink to this headline">#</a></h3>
<p>The target values that the plant should produce, and that will be passed to the loss functions. In <code class="docutils literal notranslate"><span class="pre">tensorflow</span></code> nomenclature, this is sometimes referred to as the <code class="docutils literal notranslate"><span class="pre">y_true</span></code>, to which the <code class="docutils literal notranslate"><span class="pre">y_pred</span></code> is compared. In practice this could be the position of the target for a reaching movement. If a delayed movement is desired, it could be the starting position until the go cue time, and the target position afterwards.</p>
</section>
<section id="III.-2.-c. Initial-states">
<h3>III. 2. c. Initial states<a class="headerlink" href="#III.-2.-c. Initial-states" title="Permalink to this headline">#</a></h3>
<p>The value of the initial states at simulation start. These can be obtained from the <code class="docutils literal notranslate"><span class="pre">task.get_initial_state(batch_size=batch_size)</span></code> method. If a pre-defined starting position is desired, one can pass an optional <code class="docutils literal notranslate"><span class="pre">joint_state</span></code> argument to this method as well.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="k">class</span> <span class="nc">RandomTargetReachWithLoads</span><span class="p">(</span><span class="n">mn</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">endpoint_load</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s1">'RandomTargetReachWithLoads'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_load</span> <span class="o">=</span> <span class="n">endpoint_load</span>

        <span class="c1"># losses</span>
        <span class="n">max_iso_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">plant</span><span class="o">.</span><span class="n">muscle</span><span class="o">.</span><span class="n">max_iso_force</span>
        <span class="n">c_loss</span> <span class="o">=</span> <span class="n">mn</span><span class="o">.</span><span class="n">nets</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">PositionLoss</span><span class="p">()</span>
        <span class="n">m_loss</span> <span class="o">=</span> <span class="n">mn</span><span class="o">.</span><span class="n">nets</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">L2ActivationLoss</span><span class="p">(</span><span class="n">max_iso_force</span><span class="o">=</span><span class="n">max_iso_force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_loss</span><span class="p">(</span><span class="n">assigned_output</span><span class="o">=</span><span class="s1">'cartesian position'</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">c_loss</span><span class="p">,</span> <span class="n">loss_weight</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_loss</span><span class="p">(</span><span class="n">assigned_output</span><span class="o">=</span><span class="s1">'muscle state'</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">m_loss</span><span class="p">,</span> <span class="n">loss_weight</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">n_timesteps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">validation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"validation"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="p">:</span>
            <span class="n">init_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if validation, then always start in the center (0, 0)</span>
            <span class="n">joint_state</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">plant</span><span class="o">.</span><span class="n">space_dim</span><span class="p">))</span>
            <span class="n">init_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">joint_state</span><span class="o">=</span><span class="n">joint_state</span><span class="p">)</span>

        <span class="n">goal_states_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">plant</span><span class="o">.</span><span class="n">draw_random_uniform_states</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="n">goal_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">plant</span><span class="o">.</span><span class="n">joint2cartesian</span><span class="p">(</span><span class="n">goal_states_j</span><span class="p">)</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">plant</span><span class="o">.</span><span class="n">state2target</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">goal_states</span><span class="p">,</span> <span class="n">n_timesteps</span><span class="o">=</span><span class="n">n_timesteps</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">"inputs"</span><span class="p">:</span> <span class="n">targets</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">plant</span><span class="o">.</span><span class="n">space_dim</span><span class="p">],</span>
          <span class="s2">"endpoint_load"</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint_load</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">n_timesteps</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">init_states</span><span class="p">]</span>


<span class="n">task</span> <span class="o">=</span> <span class="n">RandomTargetReachWithLoads</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span> <span class="n">endpoint_load</span><span class="o">=</span><span class="mf">3.</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Task subclass built.</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>



<span class="n">L</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_timesteps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">validation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Dictionary content:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">" shape :--&gt; "</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">targets shape :--&gt; "</span><span class="p">,</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"initial states shape:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Task subclass built.

Dictionary content:
        inputs shape :--&gt;  (5, 10, 2)
        endpoint_load shape :--&gt;  (5, 10, 2)

targets shape :--&gt;  (5, 10, 4)

initial states shape:
         (5, 4)
         (5, 4)
         (5, 4, 4)
         (5, 4, 4)
         (5, 8, 1)
         (5, 2, 1)
         (5, 4)
         (5, 50)
</pre></div></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Olivier Codol
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Create a custom Task</a></li>
<li><a class="reference internal" href="#I.-Useful-methods-in-Task-objects">I. Useful methods in Task objects</a></li>
<li><a class="reference internal" href="#II.-Initializing-a-MotorNetModel-with-a-Task-object">II. Initializing a MotorNetModel with a Task object</a></li>
<li><a class="reference internal" href="#III.-Subclassing-a-Task-object">III. Subclassing a Task object</a><ul>
<li><a class="reference internal" href="#III.-1.-Initialization-of-the-Task-subclass">III. 1. Initialization of the Task subclass</a></li>
<li><a class="reference internal" href="#III.-2.-Generating-inputs">III. 2. Generating inputs</a><ul>
<li><a class="reference internal" href="#III.-2.-a.-Input-dictionary">III. 2. a. Input dictionary</a></li>
<li><a class="reference internal" href="#III.-2.-b.-Targets">III. 2. b. Targets</a></li>
<li><a class="reference internal" href="#III.-2.-c. Initial-states">III. 2. c. Initial states</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>